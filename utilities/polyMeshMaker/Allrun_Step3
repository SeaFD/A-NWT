#!/bin/sh
# Source tutorial run functions
. $WM_PROJECT_DIR/bin/tools/RunFunctions

#====================================
# Creates the wedge by extruding the front face of the mesh from Step 2
# Translates the mesh veretically by the required initial drop height
# Requirments: Normal OpenFOAM functions
# Controlled by the system/extrudeMeshDict

# Make wedge from box
cp system/extrudeMeshDict.Wedge system/extrudeMeshDict
extrudeMesh > log.extrudeWedge


# Adjust height of domain for initial drop height. Currently sphere is centered at z=0
transformPoints -translate '(0 0 0.09)' 


# Delete the "axis" boundaries from constant/polyMesh/boundary

# Define the input and output file paths
input="constant/polyMesh/boundary"
output="constant/polyMesh/boundary_new"

# Start the awk script
awk '
BEGIN {
    # Initialize the print mode to true
    print_mode = 1;
    # Initialize the boundary count
    boundary_count = 0;
}

# Pattern to capture the boundary count
/^[0-9]+$/ {
    if (!changed) {
        # Change the boundary count
        $1 -= 2;
        changed = 1;
    }
}

# Detect the start of the axis1 or axis2 blocks
/^ +axis[12]$/ {
    print_mode = 0;  # Turn off printing
}

# Detect the end of a block
/^ +}/ {
    if (print_mode == 0) {
        print_mode = 1;  # Turn back on printing after the block ends
        next;  # Skip printing the current line
    }
}

# Print lines when print_mode is active
print_mode {
    print;
}

END {

}
' "$input" > "$output"

# Optionally, replace the original file with the new file
mv "$output" "$input"

